{"version":3,"sources":["../../src/methods/own.js"],"names":["GetOwnPropertyKeys","OrdinaryOwnPropertyKeys","EnumerableOwnProperties","realm","O","Type","obj","throwIfNotConcrete","keys","$OwnPropertyKeys","nameList","nextKey","push","o","properties","getOwnPropertyKeysArray","filter","x","map","parseInt","sort","y","key","symbols","kind","ownKeys","desc","$GetOwnProperty","enumerable","ThrowIfMightHaveBeenDeleted","value","entry"],"mappings":"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","file":"own.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { PropertyKeyValue } from \"../types.js\";\nimport type { Realm } from \"../realm.js\";\nimport { Get, ToObject, CreateArrayFromList, IsArrayIndex } from \"./index.js\";\nimport { StringValue, ObjectValue, Value, ArrayValue } from \"../values/index.js\";\nimport { Properties } from \"../singletons.js\";\n\nimport invariant from \"../invariant.js\";\n\n// ECMA262 19.1.2.8.1\nexport function GetOwnPropertyKeys(realm: Realm, O: Value, Type: Function): ArrayValue {\n  // 1. Let obj be ? ToObject(O).\n  let obj = ToObject(realm, O.throwIfNotConcrete());\n\n  // 2. Let keys be ? obj.[[OwnPropertyKeys]]().\n  let keys = obj.$OwnPropertyKeys();\n\n  // 3. Let nameList be a new empty List.\n  let nameList = [];\n\n  // 4. Repeat for each element nextKey of keys in List order,\n  for (let nextKey of keys) {\n    // a. If Type(nextKey) is Type, then\n    if (nextKey instanceof Type) {\n      // i. Append nextKey as the last element of nameList.\n      nameList.push(nextKey);\n    }\n  }\n\n  // 1. Return CreateArrayFromList(nameList).\n  return CreateArrayFromList(realm, nameList);\n}\n\n// ECMA262 9.1.11.1\nexport function OrdinaryOwnPropertyKeys(realm: Realm, o: ObjectValue): Array<PropertyKeyValue> {\n  // 1. Let keys be a new empty List.\n  let keys = [];\n\n  // 2. For each own property key P of O that is an integer index, in ascending numeric index order\n  let properties = o.getOwnPropertyKeysArray();\n  for (let key of properties.filter(x => IsArrayIndex(realm, x)).map(x => parseInt(x, 10)).sort((x, y) => x - y)) {\n    // i. Add P as the last element of keys.\n    keys.push(new StringValue(realm, key + \"\"));\n  }\n\n  // 3. For each own property key P of O that is a String but is not an integer index, in ascending chronological order of property creation\n  for (let key of properties.filter(x => !IsArrayIndex(realm, x))) {\n    // i. Add P as the last element of keys.\n    keys.push(new StringValue(realm, key));\n  }\n\n  // 4. For each own property key P of O that is a Symbol, in ascending chronological order of property creation\n  for (let key of o.symbols.keys()) {\n    // i. Add P as the last element of keys.\n    keys.push(key);\n  }\n\n  // 5. Return keys.\n  return keys;\n}\n\n// ECMA262 7.3.21\nexport function EnumerableOwnProperties(realm: Realm, O: ObjectValue, kind: string): Array<Value> {\n  // 1. Assert: Type(O) is Object.\n  invariant(O instanceof ObjectValue, \"expected object\");\n\n  // 2. Let ownKeys be ? O.[[OwnPropertyKeys]]().\n  let ownKeys = O.$OwnPropertyKeys();\n\n  // 3. Let properties be a new empty List.\n  let properties = [];\n\n  // 4. Repeat, for each element key of ownKeys in List order\n  for (let key of ownKeys) {\n    // a. If Type(key) is String, then\n    if (key instanceof StringValue) {\n      // i. Let desc be ? O.[[GetOwnProperty]](key).\n      let desc = O.$GetOwnProperty(key);\n\n      // ii. If desc is not undefined and desc.[[Enumerable]] is true, then\n      if (desc && desc.enumerable) {\n        Properties.ThrowIfMightHaveBeenDeleted(desc.value);\n\n        // 1. If kind is \"key\", append key to properties.\n        if (kind === \"key\") {\n          properties.push(key);\n        } else {\n          // 2. Else,\n          // a. Let value be ? Get(O, key).\n          let value = Get(realm, O, key);\n\n          // b. If kind is \"value\", append value to properties.\n          if (kind === \"value\") {\n            properties.push(value);\n          } else {\n            // c. Else,\n            // i. Assert: kind is \"key+value\".\n            invariant(kind === \"key+value\", \"expected kind to be key+value\");\n\n            // ii. Let entry be CreateArrayFromList(« key, value »).\n            let entry = CreateArrayFromList(realm, [key, value]);\n\n            // iii. Append entry to properties.\n            properties.push(entry);\n          }\n        }\n      }\n    }\n  }\n\n  // 5. Order the elements of properties so they are in the same relative order as would be produced by the Iterator that would be returned if the EnumerateObjectProperties internal method was invoked with O.\n\n  // 6. Return properties.\n  return properties;\n}\n"]}