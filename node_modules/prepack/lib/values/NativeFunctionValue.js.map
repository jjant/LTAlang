{"version":3,"sources":["../../src/values/NativeFunctionValue.js"],"names":["NativeFunctionValue","realm","intrinsicName","name","length","callback","constructor","$ThisMode","$HomeObject","undefined","$FunctionKind","$Call","thisArgument","argsList","$Realm","$ConstructorKind","$Construct","argumentsList","newTarget","$Environment","$GlobalEnv","$DefineOwnProperty","value","writable","configurable","enumerable","$Description","throwIfNotConcreteString","trackedPropertyNames","getLength","context","originalLength","i","intrinsics","currentLocation","concat"],"mappings":";;;;;;;;AAaA;;AAWA;;AACA;;;;;;+eAzBA;;;;;;;;;AAiCA;IACqBA,mB;;;AACnB,+BACEC,KADF,EAEEC,aAFF,EAGEC,IAHF,EAIEC,MAJF,EAKEC,QALF,EAOE;AAAA,QADAC,WACA,uEADwB,IACxB;;AAAA;;AAAA,0IACML,KADN,EACaC,aADb;;AAGA,UAAKK,SAAL,GAAiB,QAAjB;AACA,UAAKC,WAAL,GAAmBC,SAAnB;AACA,UAAKC,aAAL,GAAqB,QAArB;;AAEA,UAAKC,KAAL,GAAa,UAACC,YAAD,EAAeC,QAAf,EAA4B;AACvC,aAAO,sBAAUF,KAAV,CAAgB,MAAKG,MAArB,SAAmCF,YAAnC,EAAiDC,QAAjD,CAAP;AACD,KAFD;;AAIA,QAAIP,WAAJ,EAAiB;AACf,YAAKS,gBAAL,GAAwB,MAAxB;AACA,YAAKC,UAAL,GAAkB,UAACC,aAAD,EAAgBC,SAAhB,EAA8B;AAC9C,eAAO,sBAAUF,UAAV,CAAqB,MAAKF,MAA1B,SAAwCG,aAAxC,EAAuDC,SAAvD,CAAP;AACD,OAFD;AAGD;;AAED,UAAKC,YAAL,GAAoBlB,MAAMmB,UAA1B;;AAEA,UAAKf,QAAL,GAAgBA,QAAhB;AACA,UAAKD,MAAL,GAAcA,MAAd;;AAEA,UAAKiB,kBAAL,CAAwB,QAAxB,EAAkC;AAChCC,aAAO,uBAAgBrB,KAAhB,EAAuBG,MAAvB,CADyB;AAEhCmB,gBAAU,KAFsB;AAGhCC,oBAAc,IAHkB;AAIhCC,kBAAY;AAJoB,KAAlC;;AAOA,QAAItB,IAAJ,EAAU;AACR,UAAIA,kCAAJ,EAAiC;AAC/B,cAAKA,IAAL,GAAYA,KAAKuB,YAAL,SAAwBvB,KAAKuB,YAAL,CAAkBC,wBAAlB,GAA6CL,KAArE,SAAgF,UAA5F;AACD,OAFD,MAEO;AACL,cAAKnB,IAAL,GAAYA,IAAZ;AACD;AACD,YAAKkB,kBAAL,CAAwB,MAAxB,EAAgC;AAC9BC,eAAO,uBAAgBrB,KAAhB,EAAuB,MAAKE,IAA5B,CADuB;AAE9BoB,kBAAU,KAFoB;AAG9BC,sBAAc,IAHgB;AAI9BC,oBAAY;AAJkB,OAAhC;AAMD,KAZD,MAYO;AACL,YAAKtB,IAAL,GAAY,QAAZ;AACD;AA5CD;AA6CD;;;;8CAIwC;AACvC,aAAOH,oBAAoB4B,oBAA3B;AACD;;;uCAE2B;AAC1B,aAAO,KAAKC,SAAL,OAAqB,KAAKzB,MAAjC;AACD;;;iCAOC0B,O,EACAjB,Q,EACAK,S,EACkB;AAClB,UAAIa,iBAAiBlB,SAAST,MAA9B;AACA,WAAK,IAAI4B,IAAI,CAAb,EAAgBA,IAAI,KAAK5B,MAAzB,EAAiC4B,GAAjC,EAAsC;AACpCnB,iBAASmB,CAAT,IAAcnB,SAASmB,CAAT,KAAe,KAAKlB,MAAL,CAAYmB,UAAZ,CAAuBxB,SAApD;AACD;AACD,aAAO,kCACL,KAAKJ,QAAL,CAAcyB,OAAd,EAAuBjB,QAAvB,EAAiCkB,cAAjC,EAAiDb,SAAjD,CADK,EAEL,KAAKJ,MAAL,CAAYoB,eAFP,CAAP;AAID;;AAED;;;;;;;AApFmBlC,mB,CAuDZ4B,oB,GAAuB,mBAAYA,oBAAZ,CAAiCO,MAAjC,CAAwC,iBAAxC,C;kBAvDXnC,mB","file":"NativeFunctionValue.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Value } from \"./index.js\";\nimport type { Realm } from \"../realm.js\";\nimport { SymbolValue } from \"./index.js\";\nimport {\n  NumberValue,\n  StringValue,\n  ECMAScriptFunctionValue,\n  ObjectValue,\n  NullValue,\n  ProxyValue,\n  UndefinedValue,\n  AbstractObjectValue,\n} from \"./index.js\";\nimport { ReturnCompletion } from \"../completions.js\";\nimport { Functions } from \"../singletons.js\";\nexport type NativeFunctionCallback = (\n  context: UndefinedValue | NullValue | ObjectValue | AbstractObjectValue,\n  args: Array<Value>,\n  argLength: number,\n  newTarget?: void | ObjectValue\n) => Value;\n\n/* Built-in Function Objects */\nexport default class NativeFunctionValue extends ECMAScriptFunctionValue {\n  constructor(\n    realm: Realm,\n    intrinsicName: void | string,\n    name: void | string | SymbolValue,\n    length: number,\n    callback: NativeFunctionCallback,\n    constructor?: boolean = true\n  ) {\n    super(realm, intrinsicName);\n\n    this.$ThisMode = \"strict\";\n    this.$HomeObject = undefined;\n    this.$FunctionKind = \"normal\";\n\n    this.$Call = (thisArgument, argsList) => {\n      return Functions.$Call(this.$Realm, this, thisArgument, argsList);\n    };\n\n    if (constructor) {\n      this.$ConstructorKind = \"base\";\n      this.$Construct = (argumentsList, newTarget) => {\n        return Functions.$Construct(this.$Realm, this, argumentsList, newTarget);\n      };\n    }\n\n    this.$Environment = realm.$GlobalEnv;\n\n    this.callback = callback;\n    this.length = length;\n\n    this.$DefineOwnProperty(\"length\", {\n      value: new NumberValue(realm, length),\n      writable: false,\n      configurable: true,\n      enumerable: false,\n    });\n\n    if (name) {\n      if (name instanceof SymbolValue) {\n        this.name = name.$Description ? `[${name.$Description.throwIfNotConcreteString().value}]` : \"[native]\";\n      } else {\n        this.name = name;\n      }\n      this.$DefineOwnProperty(\"name\", {\n        value: new StringValue(realm, this.name),\n        writable: false,\n        configurable: true,\n        enumerable: false,\n      });\n    } else {\n      this.name = \"native\";\n    }\n  }\n\n  static trackedPropertyNames = ObjectValue.trackedPropertyNames.concat(\"$RevocableProxy\");\n\n  getTrackedPropertyNames(): Array<string> {\n    return NativeFunctionValue.trackedPropertyNames;\n  }\n\n  hasDefaultLength(): boolean {\n    return this.getLength() === this.length;\n  }\n\n  name: string;\n  callback: NativeFunctionCallback;\n  length: number;\n\n  callCallback(\n    context: UndefinedValue | NullValue | ObjectValue | AbstractObjectValue,\n    argsList: Array<Value>,\n    newTarget?: void | ObjectValue\n  ): ReturnCompletion {\n    let originalLength = argsList.length;\n    for (let i = 0; i < this.length; i++) {\n      argsList[i] = argsList[i] || this.$Realm.intrinsics.undefined;\n    }\n    return new ReturnCompletion(\n      this.callback(context, argsList, originalLength, newTarget),\n      this.$Realm.currentLocation\n    );\n  }\n\n  // for Proxy\n  $RevocableProxy: void | NullValue | ProxyValue;\n}\n"]}