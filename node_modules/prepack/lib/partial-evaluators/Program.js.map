{"version":3,"sources":["../../src/partial-evaluators/Program.js"],"names":["ast","strictCode","env","realm","partialBody","val","body","node","type","partiallyEvaluateCompletionDeref","potentialVal","partialAst","nio","ioAst","push","result","intrinsics","empty","t","program","directives"],"mappings":";;;;;;ypBAAA;;;;;;;;;kBAsBe,UACbA,GADa,EAEbC,UAFa,EAGbC,GAHa,EAIbC,KAJa,EAKsD;AACnEF,eAAa,sBAASD,GAAT,CAAb;;AAEA,+CAA+BG,KAA/B,EAAsCH,GAAtC,EAA2CE,GAA3C,EAAgDD,UAAhD;;AAEA,MAAIG,cAAsE,EAA1E;AACA,MAAIC,YAAJ;;AANmE;AAAA;AAAA;;AAAA;AAQnE,yBAAiBL,IAAIM,IAArB,8HAA2B;AAAA,UAAlBC,IAAkB;;AACzB,UAAIA,KAAKC,IAAL,KAAc,qBAAlB,EAAyC;AAAA,oCACDN,IAAIO,gCAAJ,CAAqCF,IAArC,EAA2CN,UAA3C,CADC;AAAA;AAAA,YAClCS,YADkC;AAAA,YACpBC,UADoB;AAAA,YACRC,GADQ;;AAAA;AAAA;AAAA;;AAAA;AAEvC,gCAAkBA,GAAlB;AAAA,gBAASC,KAAT;AAAuBT,wBAAYU,IAAZ,CAAiBD,KAAjB;AAAvB;AAFuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAGvCT,oBAAYU,IAAZ,CAAkBH,UAAlB;AACA,YAAI,EAAED,yCAAF,CAAJ,EAA2CL,MAAMK,YAAN;AAC5C,OALD,MAKO;AACL;AACAN,oBAAYU,IAAZ,CAAiBP,IAAjB;AACD;AACF;;AAED;AACA;AACA;AACA;AAvBmE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAyBnE,MAAIQ,SAASV,OAAOF,MAAMa,UAAN,CAAiBC,KAArC;AACA,SAAO,CAACF,MAAD,EAASG,EAAEC,OAAF,CAAUf,WAAV,EAAuBJ,IAAIoB,UAA3B,CAAT,EAAiD,EAAjD,CAAP;AACD,C;;AAvCD;;AACA;;AACA;;AAEA;;;;AACA;;IAAYF,C","file":"Program.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { BabelNodeProgram, BabelNodeStatement, BabelNodeModuleDeclaration } from \"babel-types\";\nimport type { LexicalEnvironment } from \"../environment.js\";\nimport type { Realm } from \"../realm.js\";\n\nimport { Completion } from \"../completions.js\";\nimport { EmptyValue, Value } from \"../values/index.js\";\nimport { GlobalDeclarationInstantiation } from \"../evaluators/Program.js\";\n\nimport IsStrict from \"../utils/strict.js\";\nimport * as t from \"babel-types\";\n\nexport default function(\n  ast: BabelNodeProgram,\n  strictCode: boolean,\n  env: LexicalEnvironment,\n  realm: Realm\n): [Completion | Value, BabelNodeProgram, Array<BabelNodeStatement>] {\n  strictCode = IsStrict(ast);\n\n  GlobalDeclarationInstantiation(realm, ast, env, strictCode);\n\n  let partialBody: Array<BabelNodeStatement | BabelNodeModuleDeclaration> = [];\n  let val;\n\n  for (let node of ast.body) {\n    if (node.type !== \"FunctionDeclaration\") {\n      let [potentialVal, partialAst, nio] = env.partiallyEvaluateCompletionDeref(node, strictCode);\n      for (let ioAst of nio) partialBody.push(ioAst);\n      partialBody.push((partialAst: any));\n      if (!(potentialVal instanceof EmptyValue)) val = potentialVal;\n    } else {\n      // TODO: this goes away once residual functions are partially evaluated.\n      partialBody.push(node);\n    }\n  }\n\n  // todo: compute a global fixed point by invoking each escaped (i.e. call back)\n  // function with dummy arguments and joining their effects with the\n  // global state until there is no invocation that causes further changes to\n  // the global state.\n\n  let result = val || realm.intrinsics.empty;\n  return [result, t.program(partialBody, ast.directives), []];\n}\n"]}