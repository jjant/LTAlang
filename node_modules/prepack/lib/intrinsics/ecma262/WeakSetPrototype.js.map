{"version":3,"sources":["../../../src/intrinsics/ecma262/WeakSetPrototype.js"],"names":["realm","obj","defineNativeMethod","context","value","S","throwIfNotConcrete","createErrorThrowCompletion","intrinsics","TypeError","$WeakSetData","recordModifiedProperty","$WeakSetData_binding","entries","e","undefined","push","false","i","length","true","defineNativeProperty","SymbolToStringTag","writable"],"mappings":"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","file":"WeakSetPrototype.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\nimport { StringValue, ObjectValue } from \"../../values/index.js\";\nimport { SameValuePartial } from \"../../methods/index.js\";\nimport invariant from \"../../invariant.js\";\n\nexport default function(realm: Realm, obj: ObjectValue): void {\n  // ECMA262 23.4.3.1\n  obj.defineNativeMethod(\"add\", 1, (context, [value]) => {\n    // 1. Let S be the this value.\n    let S = context.throwIfNotConcrete();\n\n    // 2. If Type(S) is not Object, throw a TypeError exception.\n    if (!(S instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Type(S) is not Object\");\n    }\n\n    // 3. If S does not have a [[WeakSetData]] internal slot, throw a TypeError exception.\n    if (!S.$WeakSetData) {\n      throw realm.createErrorThrowCompletion(\n        realm.intrinsics.TypeError,\n        \"S does not have a [[WeakSetData]] internal slot\"\n      );\n    }\n\n    // 4. If Type(value) is not Object, throw a TypeError exception.\n    value = value.throwIfNotConcrete();\n    if (!(value instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Type(value) is not Object\");\n    }\n\n    // 5. Let entries be the List that is S.[[WeakSetData]].\n    realm.recordModifiedProperty((S: any).$WeakSetData_binding);\n    let entries = S.$WeakSetData;\n    invariant(entries != null);\n\n    // 6. Repeat for each e that is an element of entries,\n    for (let e of entries) {\n      // a. If e is not empty and SameValue(e, value) is true, then\n      if (e !== undefined && SameValuePartial(realm, e, value) === true) {\n        // i. Return S.\n        return S;\n      }\n    }\n\n    // 7. Append value as the last element of entries.\n    entries.push(value);\n\n    // 8. Return S.\n    return S;\n  });\n\n  // ECMA262 23.4.3.3\n  obj.defineNativeMethod(\"delete\", 1, (context, [value]) => {\n    // 1. Let S be the this value.\n    let S = context.throwIfNotConcrete();\n\n    // 2. If Type(S) is not Object, throw a TypeError exception.\n    if (!(S instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Type(S) is not Object\");\n    }\n\n    // 3. If S does not have a [[WeakSetData]] internal slot, throw a TypeError exception.\n    if (!S.$WeakSetData) {\n      throw realm.createErrorThrowCompletion(\n        realm.intrinsics.TypeError,\n        \"S does not have a [[WeakSetData]] internal slot\"\n      );\n    }\n\n    // 4. If Type(value) is not Object, throw a TypeError exception.\n    value = value.throwIfNotConcrete();\n    if (!(value instanceof ObjectValue)) return realm.intrinsics.false;\n\n    // 5. Let entries be the List that is S.[[WeakSetData]].\n    realm.recordModifiedProperty((S: any).$WeakSetData_binding);\n    let entries = S.$WeakSetData;\n    invariant(entries != null);\n\n    // 6. Repeat for each e that is an element of entries,\n    for (let i = 0; i < entries.length; ++i) {\n      let e = entries[i];\n\n      // a. If e is not empty and SameValue(e, value) is true, then\n      if (e !== undefined && SameValuePartial(realm, e, value) === true) {\n        // i. Replace the element of entries whose value is e with an element whose value is empty.\n        entries[i] = undefined;\n\n        // ii. Return true.\n        return realm.intrinsics.true;\n      }\n    }\n\n    // 7. Return false.\n    return realm.intrinsics.false;\n  });\n\n  // ECMA262 23.4.3.3\n  obj.defineNativeMethod(\"has\", 1, (context, [value]) => {\n    // 1. Let S be the this value.\n    let S = context.throwIfNotConcrete();\n\n    // 2. If Type(S) is not Object, throw a TypeError exception.\n    if (!(S instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Type(S) is not Object\");\n    }\n\n    // 3. If S does not have a [[WeakSetData]] internal slot, throw a TypeError exception.\n    if (!S.$WeakSetData) {\n      throw realm.createErrorThrowCompletion(\n        realm.intrinsics.TypeError,\n        \"S does not have a [[WeakSetData]] internal slot\"\n      );\n    }\n\n    // 4. Let entries be the List that is S.[[WeakSetData]].\n    let entries = S.$WeakSetData;\n\n    // 5. If Type(value) is not Object, return false.\n    value = value.throwIfNotConcrete();\n    if (!(value instanceof ObjectValue)) return realm.intrinsics.false;\n\n    // 6. Repeat for each e that is an element of entries,\n    for (let e of entries) {\n      // a. If e is not empty and SameValue(e, value) is true, return true.\n      if (e !== undefined && SameValuePartial(realm, e, value) === true) return realm.intrinsics.true;\n    }\n\n    // 7. Return false.\n    return realm.intrinsics.false;\n  });\n\n  // ECMA262 23.4.3.5\n  obj.defineNativeProperty(realm.intrinsics.SymbolToStringTag, new StringValue(realm, \"WeakSet\"), { writable: false });\n}\n"]}